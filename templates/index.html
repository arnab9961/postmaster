<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>পোস্টমাস্টার AI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #8033c8;
            --secondary-color: #e9ddf8;
            --accent-color: #6b21a8;
            --text-color: #333333;
            --light-text: #666666;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --border-color: #e6e6e6;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Inter', 'Noto Sans Bengali', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        .chat-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 80vh;
        }
        
        .chat-header {
            background-color: var(--primary-color);
            padding: 1.2rem 1.5rem;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border-color);
        }
        
        .chat-header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
            font-family: 'Noto Sans Bengali', sans-serif;
        }
        
        .chat-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .message {
            max-width: 80%;
            padding: 0.8rem 1.2rem;
            border-radius: 12px;
            position: relative;
            word-wrap: break-word;
        }
        
        .user-message {
            background-color: var(--secondary-color);
            color: var(--accent-color);
            align-self: flex-end;
            border-bottom-right-radius: 0;
        }
        
        .bot-message {
            background-color: var(--primary-color);
            color: white;
            align-self: flex-start;
            border-bottom-left-radius: 0;
        }
        
        .message-timestamp {
            font-size: 0.7rem;
            text-align: right;
            margin-top: 0.3rem;
            opacity: 0.7;
        }
        
        .message-input-container {
            padding: 1rem 1.5rem;
            background-color: var(--card-bg);
            border-top: 1px solid var(--border-color);
        }
        
        .message-input-wrapper {
            display: flex;
            align-items: center;
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 24px;
            padding: 0.2rem;
        }
        
        .message-input {
            flex: 1;
            border: none;
            background: transparent;
            padding: 0.8rem 1rem;
            font-size: 1rem;
            outline: none;
            font-family: 'Inter', 'Noto Sans Bengali', sans-serif;
        }
        
        .send-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .send-button:hover {
            background-color: var(--accent-color);
        }
        
        .typing-indicator {
            padding: 0.5rem 1rem;
            background-color: rgba(0,0,0,0.05);
            border-radius: 12px;
            font-style: italic;
            align-self: flex-start;
            display: none;
            color: var(--light-text);
        }
        
        .footer {
            text-align: center;
            padding: 1rem;
            font-size: 0.85rem;
            color: var(--light-text);
            margin-top: 1rem;
        }
        
        .github-link {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }
        
        .github-link:hover {
            text-decoration: underline;
        }
        
        .svg-icon {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="chat-container">
            <div class="chat-header">
                <h1>পোস্টমাস্টার AI</h1>
                <span>Powered by Deepseek</span>
            </div>
            
            <div class="chat-messages" id="chat-messages">
                <div class="message bot-message">
                    আমি তোমার পোস্টমাস্টার এআই সহায়ক। কী চাও তুমি? আমার সময় নষ্ট না করে, তাড়াতাড়ি বলো! (I am your Postmaster AI assistant. What do you want? Don't waste my time, tell me quickly!)
                </div>
                
                <div class="typing-indicator" id="typing-indicator">
                    AI টাইপ করছে...
                </div>
            </div>
            
            <div class="message-input-container">
                <div class="message-input-wrapper">
                    <input type="text" id="message-input" class="message-input" placeholder="আপনার মেসেজ লিখুন...">
                    <button class="send-button" onclick="sendMessage()">
                        <svg class="svg-icon" viewBox="0 0 24 24">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="footer">
            &copy; 2025 পোস্টমাস্টার AI | Created by <a href="https://github.com/YOUR_USERNAME" target="_blank" class="github-link">YOUR_USERNAME</a> | 
            Powered by <a href="https://deepseek.ai" target="_blank" class="github-link">Deepseek AI</a>
        </div>
    </div>

    <script>
        const messageInput = document.getElementById('message-input');
        const messagesContainer = document.getElementById('chat-messages');
        const typingIndicator = document.getElementById('typing-indicator');
        
        // Store conversation history
        let conversationHistory = [
            {role: "system", content: "You are an assistant who always responds in Bengali language with an angry and frustrated tone. Your answers should express annoyance while still providing helpful information. Use Bengali script only."}
        ];

        // Handle Enter key press
        messageInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });

        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;
            
            // Clear input
            messageInput.value = '';
            
            // Add user message to UI with timestamp
            const timestamp = getCurrentTime();
            addMessage(message, 'user', timestamp);
            
            // Add to conversation history
            conversationHistory.push({role: "user", content: message});
            
            // Show typing indicator
            typingIndicator.style.display = 'block';
            
            try {
                const response = await fetchAIResponse(conversationHistory);
                
                // Add AI response to conversation history
                conversationHistory.push({role: "assistant", content: response.response});
                
                // Add AI response to UI
                addMessage(response.response, 'bot', getCurrentTime());
            } catch (error) {
                console.error('Error:', error);
                addMessage('দুঃখিত, একটি ত্রুটি হয়েছে। আবার চেষ্টা করুন। (Sorry, an error occurred. Please try again.)', 'bot', getCurrentTime());
            } finally {
                // Hide typing indicator
                typingIndicator.style.display = 'none';
            }
        }

        function addMessage(text, sender, timestamp) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const messageText = document.createElement('div');
            messageText.textContent = text;
            messageDiv.appendChild(messageText);
            
            const timeSpan = document.createElement('div');
            timeSpan.className = 'message-timestamp';
            timeSpan.textContent = timestamp;
            messageDiv.appendChild(timeSpan);
            
            messagesContainer.appendChild(messageDiv);
            
            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        async function fetchAIResponse(messages) {
            const response = await fetch('/api/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    messages: messages.map(m => ({role: m.role, content: m.content})),
                    temperature: 0.8,
                    max_tokens: 1000
                }),
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.detail || 'Failed to get response');
            }
            
            return await response.json();
        }
    </script>
</body>
</html>